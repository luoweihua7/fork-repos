## 1.创建RouterOS日志硬盘

我们知道 RouterOS 的日志都在内存中，当系统重启后历史日志记录将会丢失。  

而使用附加硬盘来记录 RouterOS 的日志后，可以在系统意外重启时候看到历史日志信息，方便追溯问题。  

登录 PVE 的 WEB 管理后台，进入 RouterOS 虚拟机 `硬件` 配置界面。  

点击顶部 `添加` 按钮，选择 `硬盘` ：

![PVE添加硬盘](img/p8/pve_add_hd.png) 

`总线/设备` 选择 `SCSI` ，设备编号 PVE 会自动设置，演示中为 `1` 。  

`磁盘大小` 根据 PVE 服务器资源剩余情况酌情设置，演示为 `0.5` GiB。  

勾选底部 `高级` 选项，并勾选 `IO thread` ：

![PVE添加硬盘参数](img/p8/pve_add_hd_details.png)

日志硬盘添加完成后，如图所示：

![PVE添加硬盘完成](img/p8/pve_add_hd_done.png)

## 2.RouterOS格式化硬盘

打开 Winbox ，使用具有管理员权限的账号进行登录。  

点击 Winbox 左侧导航 `System` 菜单的子菜单 `Disks` ，查看当前硬盘列表：

![磁盘列表](img/p8/wb_disks.png)

鼠标 **单击** 选中新加入的磁盘，点击 `Format Drive` 按钮，对磁盘进行格式化操作。  

|参数|值|说明|
|--|--|--|
|Disk|`QEMU HARDDISK`|无需修改|
|File System|`ext4`|磁盘的文件系统，可选 `ext4` 和 `fat32` ，建议 `ext4`|
|Label|`syslog`|磁盘的标签，可用英文自由定义|

![格式化磁盘](img/p8/wb_format_disk.png)

等待磁盘格式化完成后，可修改磁盘的名称，便于后续使用。  

鼠标 **双击** 分区条目 `slot-part1` ，进入磁盘编辑界面，修改 `Name` 并添加 `Comment` 备注信息：

|参数|值|说明|
|--|--|--|
|Name|`log`|磁盘名称|
|Comment|`defconf: System Log Disk`|备注信息|

![修改磁盘信息](img/p8/wb_modify_disk.png)

## 3.配置RouterOS日志规则

### 3.1.添加日志操作方式

点击 Winbox 左侧导航 `System` 菜单的子菜单 `Logging` ，查看当前日志操作方式条目。  

点击添加按钮，新建一个日志操作方式：  

![添加日志操作方式](img/p8/wb_add_log_action.png)

在弹出的对话框中，对日志操作方式进行调整：

|参数|值|说明|
|--|--|--|
|Name|`syslog`|名称，可使用英文自由定义|
|Type|`disk`|表示操作方式为写入硬盘|
|File Name|`/log/syslog`|文件路径以及文件名称前缀|
|Lines Per File|`1000`|每个文件的行数，保持默认 1000 即可|
|File Count|`100`|保留的日志文件数|

 **注意：**   
 **文件路径 `/log/` 为之前修改的磁盘名称，需要根据实际情况进行调整。**   
 **每个日志文件记录了 `1000` 行日志条目后就会新创建一个日志文件。**   
 **设置了 `File Count` 为 `100` 后，该日志磁盘中将总共有 `100` 个日志文件，共计 `10000 (1000 x 10)` 行日志。**   